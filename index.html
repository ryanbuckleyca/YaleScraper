<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YaleScraper</title>
</head>
<body>
  <script>
    const callAPI = async (url) => {
      const res = await fetch(url)
      const data = await res.text()
      const parser = new DOMParser()
      const htmlDoc = parser.parseFromString(data, 'text/html')
      return htmlDoc
    }

    const loadImage = async (a) => {
      htmlDoc = await callAPI(`http://localhost:8080/findImageURL?link=${a}`)
      const imgURL = htmlDoc.getElementById('mainImageEnlarge')
      window.location = imgURL.href;
    }

    const listResults = (thumbs) => {
      document.write("<div>Multiple results found</div>")
      const list = []
      thumbs.forEach(thumb => list.push(thumb.querySelector('a')))
      document.write(list)
    }

    const search = async () => {
      const params = window.location.search
      const htmlDoc = await callAPI(`http://localhost:8080/search?${params}`)
      const docs = htmlDoc.getElementById('documents');
      const thumbs = docs.querySelectorAll('.yale_thumbnail')
      if(!thumbs) return "no results"

      thumbs.length === 1
        ? loadImage(thumbs[0].querySelector('a').href)
        : listResults(thumbs)
    }

    search();
  </script>

</body>
</html>